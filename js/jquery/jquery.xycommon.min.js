/*
 * jQuery Commonly Usage Plugins Collection
 *
 * jquery.xycommon.js v2.1
 *
 * Copyright (c) 2009 XYBASE, <imam@xybase.com><geekzy@gmail.com>
 *
 */
(function($){$.extend({cache:{},namespace:function(){var o,d;$.each(arguments,function(){d=this.split(".");o=window[d[0]]=window[d[0]]||{};$.each(d.slice(1),function(){o=o[this]=o[this]||{}})});return o},tmpl:function(tmpl,vals,rgxp){tmpl=tmpl||'';vals=vals||{};rgxp=rgxp||/#\{([^{}]*)\}/g;var repr=function(str,match){return typeof vals[match]==='string'||typeof vals[match]==='number'?vals[match]:''};return tmpl.replace(rgxp,repr)},template:function(str,data){var fn=!/\W/.test(str)?$.cache[str]=$.cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('').trim();");return data?fn(data):fn},popup:function(options){var openoptions,opts=$.extend({url:'#',left:"",top:"",width:800,height:600,name:"_blank",location:"no",menubar:"no",toolbar:"no",status:"yes",scrollbars:"yes",resizable:"yes",normal:false},options||{});if(opts.normal){opts.menubar="yes";opts.status="yes";opts.toolbar="yes";opts.location="yes"}opts.width=opts.width<screen.availWidth?opts.width:screen.availWidth;opts.height=opts.height<screen.availHeight?opts.height:screen.availHeight;openoptions='width='+opts.width+',height='+opts.height+',location='+opts.location+',menubar='+opts.menubar+',toolbar='+opts.toolbar+',scrollbars='+opts.scrollbars+',resizable='+opts.resizable+',status='+opts.status;if(opts.top!==''){openoptions+=",top="+opts.top}if(opts.left!==''){openoptions+=",left="+opts.left}return window.open(opts.url,opts.name,openoptions)},execute:function(functionName,context){var i,args=Array.prototype.slice.call(arguments).splice(2),namespaces=functionName.split("."),func=namespaces.pop();for(i=0;i<namespaces.length;i++){context=context[namespaces[i]]}return context[func].apply(this,args)},jsonp:function(url,callback,fn,data,options){$.ajax($.extend({url:url,data:data||{},dataType:'jsonp',jsonp:false,jsonpCallback:callback,success:fn},options||{}))},cachedScript:function(url,options,succFn){options=$.extend(options||{},{dataType:"script",cache:true,url:url,success:succFn||$.noop});return jQuery.ajax(options)},randomString:function(len,special){len=len||8;special=special||false;var i=0,str='',rndNum;while(i<len){rndNum=(Math.floor((Math.random()*100))%94)+33;if(!special){if((rndNum>=33)&&(rndNum<=47)){continue}if((rndNum>=58)&&(rndNum<=64)){continue}if((rndNum>=91)&&(rndNum<=96)){continue}if((rndNum>=123)&&(rndNum<=126)){continue}}i++;str+=String.fromCharCode(rndNum)}return str},loading:function(){var waitPage=$('[data-role=page].wait');waitPage.bind('pageshow',function(e,ui){$.mobile.showPageLoadingMsg()});waitPage.bind('pagehide',function(e,ui){$.mobile.hidePageLoadingMsg()})},pluck:function(obj,key){var plucked=[];$.each(obj,function(){plucked.push(this[key])});return plucked},empty:function(str){return str===''},bool:function(val){return(/^true$/i).test(val)}});var plugins={clear:function(){return this.each(function(){$(this).html('')})},loadOptions:function(url,options){return this.each(function(){var select=$(this),tmpl='<option value="#{id}" title="#{title}">#{label}</option>',opts=$.extend({url:url||'',type:'GET',data:{},cache:false,dataType:'json',value:'',remote:true,key:'options',select:function(val){select.val(val)},beforeSend:function(){select.disableElement();var loader=$.tmpl(tmpl,{id:'',label:'Loading...'});select.html(loader)},success:function(data){select.clear();if(data instanceof Object){data=data[this.key]}if(data){$.each(data,function(){var label=this['label'],value=$.extend({title:label},this),opt=$.tmpl(tmpl,value);select.append(opt)});this.select(this.value);this.afterLoaded.call(select)}},afterLoaded:function(){},complete:function(){select.enableElement()}},options||{});if(opts.remote){$.ajax(opts)}else{opts.beforeSend();opts.success.call(opts,opts.data)}})},isScrolledIntoView:function(){var elm=$(this[0]),docViewTop=$(window).scrollTop(),docViewBottom=docViewTop+$(window).height(),elemTop=elm.offset().top,elemBottom=elemTop+elm.height();return((elemBottom>=docViewTop)&&(elemTop<=docViewBottom))},scrollHere:function(delay){var elm=$(this[0]);$('html, body').animate({scrollTop:elm.offset().top},delay||500)},disableElement:function(clazz){return this.each(function(){$(this).addClass(clazz||"ui-state-disabled").attr("disabled","disabled")})},enableElement:function(clazz){return this.each(function(){$(this).removeClass(clazz||"ui-state-disabled").removeAttr("disabled")})},readonly:function(status){return this.each(function(){if(typeof status=='undefined'||status!==false){$(this).attr('readonly','readonly')}else{$(this).removeAttr('readonly')}})},jsonSerialize:function(toObject,exception){var obj={},form=this[0],lastName='',arr=[];if(!JSON){throw'Please include json2.js'}if(form.tagName!=='FORM'){return''}$(form.elements).each(function(){var elt=$(this),count=$(':input[name='+this.name+']',form).length;if((elt.is(':checkbox')||elt.is(':radio'))&&!this.checked){return}if(!$.empty(this.name)||(exception&&!$.inArray(this.name,exception))){if(!toObject||(toObject&&elt.val()!=null)){if(count>1&&!elt.is(':radio')){arr.push(elt.val());if(this.name!=lastName){arr=[];arr.push(elt.val())}obj[this.name]=arr}else{obj[this.name]=elt.val();arr=[]}lastName=this.name}}});return toObject?obj:JSON.stringify(obj)},formClear:function(except){return this.each(function(){var form=$(this),isForm=this.tagName==='FORM';if(!isForm){return}except=$.isArray(except)?except:[except];$('*',form).filter(':input').each(function(){var input=$(this),id=input.is(':checkbox, :radio')?input.attr('name'):input.attr('id'),skip=$.inArray(id,except)!=-1;if(input.is(':button, :submit')||skip){return true}else if(input.is(':text, [type=hidden], select')){input.val('')}else if(input.is(':checkbox, :radio')){$(':input[name="'+input.attr('name')+'"]',form).each(function(){this.checked=false})}})})},randomId:function(len){return this.each(function(){var el=$(this);el.attr('id',$.randomString(len||8))})},outerHTML:function(){return $.map(this,function(el){return el.outerHTML})},switchClass:function(fclazz,nclazz){return this.each(function(){var el=$(this);el.toggleClass(fclazz||'',false).addClass(nclazz||'')})}};$.each(plugins,function(i){$.fn[i]=this})})(jQuery);String.prototype.bool=function(){return(/^true$/i).test(this)};String.prototype.empty=function(){return this==''};String.prototype.startsWith=function(str){return(this.match('^'+str)==str)};String.prototype.endsWith=function(str){return(this.match(str+'$')==str)};String.prototype.trim=function(){return(this.replace(/^[\s\xA0]+/,'').replace(/[\s\xA0]+$/,''))};String.prototype.toUpperFirst=function(){return this.toLowerCase().replace(/(^[a-z])/g,function($1){return $1.toUpperCase()})};String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function($1){return $1.toUpperCase().replace('-','')})};String.prototype.count=function(ch){return this.split(ch||'').length};